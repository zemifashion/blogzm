var tdcWindowFrame;
(function(b,e){tdcWindowFrame={_isInitialized:!1,_arrCssSelectors:[],_inMoving:!1,_inResizing:!1,$_currentWindowFrame:e,$_tdcIframeCover:e,$_tdcSidebar:e,$_window:e,moveCssSelector:"",resizeCssSelector:"",_currentWindowPosition:e,_lastZIndex:1E3,_resizeOffset:e,_markerCssClass:"tdc-window-frame",init:function(a){if(!tdcWindowFrame._isInitialized){tdcWindowFrame._arrCssSelectors=a;tdcWindowFrame.$_window=b(window);tdcWindowFrame.$_tdcIframeCover=b("#tdc-iframe-cover");tdcWindowFrame.$_tdcSidebar=b("#tdc-sidebar");
for(var c=0;c<a.length;c++){var d=a[c]+" header.tdb-wm-header-drag",f=a[c]+" .tdw-resize";0!==c&&(d=","+d,f=","+f);tdcWindowFrame.moveCssSelector+=d;tdcWindowFrame.resizeCssSelector+=f;b(a[c]).on("mousedown",function(a){a=b(this);a.hasClass("tdw-inactive")&&tdcWindowFrame.setWindowFrame(a)})}tdcWindowFrame.setEvents();tdcWindowFrame.$_window.on("resize",function(){b("."+tdcWindowFrame._markerCssClass).each(function(a,c){a=b(c);c={};var d=a.offset();d.left+100>tdcWindowFrame.$_window.width()&&(c.left=
tdcWindowFrame.$_window.width()-100);d.top+100>tdcWindowFrame.$_window.height()&&(c.top=tdcWindowFrame.$_window.height()-100);b.isEmptyObject(c)||a.css(c)});"undefined"!==typeof tdcContextMenu&&tdcContextMenu.hide()});tdcWindowFrame._isInitialized=!0}},moveCssSelectorMouseDownHandler:function(a){a.currentTarget===a.target&&(tdcWindowFrame.$_currentWindowFrame=b(a.currentTarget).parent(),tdcWindowFrame.setWindowFrame(tdcWindowFrame.$_currentWindowFrame),tdcWindowFrame._inMoving=!0,tdcWindowFrame.setCurrentWindowFramePosition(a),
tdcWindowFrame.setMouseInitialPosition({left:a.pageX,top:a.pageY}),tdcWindowFrame._disableCurrentWindowContent())},moveCssSelectorMouseUpHandler:function(a){a.currentTarget===a.target&&(tdcWindowFrame._inMoving=!1,tdcWindowFrame.setCurrentWindowFramePosition(a),tdcWindowFrame.setMouseInitialPosition(e),tdcWindowFrame._disableBackground(!1),tdcWindowFrame._enableCurrentWindowContent())},bodyMouseUpHandler:function(a){tdcWindowFrame._inMoving=!1;tdcWindowFrame._inResizing=!1;tdcWindowFrame.setCurrentWindowFramePosition(a);
tdcWindowFrame.setMouseInitialPosition({left:a.pageX,top:a.pageY});tdcWindowFrame._resizeOffset=e;tdcWindowFrame._disableBackground(!1)},bodyMouseMoveHandler:function(a){b(this);if(tdcWindowFrame._inMoving){a.stopPropagation();a.preventDefault();var c=tdcWindowFrame.getMouseInitialPosition();if("undefined"!==typeof c){var d=tdcWindowFrame.getCurrentWindowFramePosition();tdcWindowFrame.$_currentWindowFrame.css({left:a.pageX-(c.left-d.left),top:a.pageY-(c.top-d.top)});tdcWindowFrame.$_currentWindowFrame.addClass("clear-position");
tdcWindowFrame._disableBackground()}}else if(tdcWindowFrame._inResizing&&(a.stopPropagation(),a.preventDefault(),c=tdcWindowFrame.getMouseInitialPosition(),"undefined"!==typeof c)){var f={offsetLeft:0,offsetTop:0};_.isUndefined(tdcWindowFrame._resizeOffset)||(f=tdcWindowFrame._resizeOffset);d=tdcWindowFrame.getCurrentWindowFramePosition();c=a.pageX-d.left+f.width-f.offsetLeft;a=a.pageY-d.top+f.height-f.offsetTop;tdcWindowFrame.$_currentWindowFrame.css({width:c,height:a});tdcWindowFrame.$_currentWindowFrame.data("width",
c);tdcWindowFrame.$_currentWindowFrame.data("height",a);tdcWindowFrame._timerResize=setTimeout(function(){"undefined"!==typeof tdcWindowFrame._timerResize&&(clearTimeout(tdcWindowFrame._timerResize),editor.resize(!0))},100);tdcWindowFrame._disableBackground()}},resizeCssSelectorMouseDownHandler:function(a){if(a.currentTarget===a.target){var c=b(a.currentTarget);tdcWindowFrame.$_currentWindowFrame=b(a.currentTarget).closest("."+tdcWindowFrame._markerCssClass);tdcWindowFrame.setWindowFrame(tdcWindowFrame.$_currentWindowFrame);
tdcWindowFrame._inResizing=!0;tdcWindowFrame.setCurrentWindowFramePosition(a);tdcWindowFrame.setMouseInitialPosition({left:a.pageX,top:a.pageY});tdcWindowFrame._resizeOffset={width:c.width(),height:c.height(),offsetLeft:a.pageX-c.offset().left,offsetTop:a.pageY-c.offset().top}}},resizeCssSelectorMouseUpHandler:function(a){a.currentTarget===a.target&&(tdcWindowFrame._inResizing=!1,tdcWindowFrame.setMouseInitialPosition(e),tdcWindowFrame._disableBackground(!1),tdcWindowFrame._resizeOffset=e)},generalClickHandler:function(a){a.currentTarget===
a.target&&(a=b(a.currentTarget).closest(".tdc-window-frame"),"tdw-css-writer"!==a.attr("id")&&(a.removeClass("clear-position"),a.css({left:"",top:""})),tdcWindowFrame.unsetWindowFrame(a))},generalMouseDownHandler:function(a){a=b(a.currentTarget);a.hasClass("tdw-inactive")&&tdcWindowFrame.setWindowFrame(a)},setEvents:function(){var a=b("body");a.unbind("mousedown",tdcWindowFrame.moveCssSelectorMouseDownHandler);a.on("mousedown",tdcWindowFrame.moveCssSelector,tdcWindowFrame.moveCssSelectorMouseDownHandler);
a.unbind("mouseup",tdcWindowFrame.moveCssSelectorMouseUpHandler);a.on("mouseup",tdcWindowFrame.moveCssSelector,tdcWindowFrame.moveCssSelectorMouseUpHandler);a.unbind("mouseup",tdcWindowFrame.bodyMouseUpHandler);a.on("mouseup",tdcWindowFrame.bodyMouseUpHandler);a.unbind("mousemove",tdcWindowFrame.bodyMouseMoveHandler);a.on("mousemove",tdcWindowFrame.bodyMouseMoveHandler);a.unbind("mousedown",tdcWindowFrame.resizeCssSelectorMouseDownHandler);a.on("mousedown",tdcWindowFrame.resizeCssSelector,tdcWindowFrame.resizeCssSelectorMouseDownHandler);
a.unbind("mouseup",tdcWindowFrame.resizeCssSelectorMouseUpHandler);a.on("mouseup",tdcWindowFrame.resizeCssSelector,tdcWindowFrame.resizeCssSelectorMouseUpHandler);a.unbind("click",tdcWindowFrame.generalClickHandler);a.on("click",".tdw-css-writer-expand .tdw-expand-collapse, .tdw-close, .tdc-iframe-close-button",tdcWindowFrame.generalClickHandler);a.unbind("mousedown",tdcWindowFrame.generalMouseDownHandler);a.on("mousedown",".tdc-window-frame",tdcWindowFrame.generalMouseDownHandler)},add:function(a){if(tdcWindowFrame._isInitialized){for(var c=
0;c<a.length;c++){var d=a[c]+" header.tdb-wm-header-drag",f=a[c]+" .tdw-resize";""!==tdcWindowFrame.moveCssSelector&&(d=","+d);tdcWindowFrame.moveCssSelector+=d;""!==tdcWindowFrame.resizeCssSelector&&(f=","+f);tdcWindowFrame.resizeCssSelector+=f;b(a[c]).on("mousedown",function(a){a=b(this);a.hasClass("tdw-inactive")&&tdcWindowFrame.setWindowFrame(a)})}tdcWindowFrame.setEvents()}},getCurrentWindowFramePosition:function(){return tdcWindowFrame._currentWindowPosition},setCurrentWindowFramePosition:function(a){tdcWindowFrame._currentWindowPosition=
"undefined"===typeof tdcWindowFrame.$_currentWindowFrame?e:tdcWindowFrame.$_currentWindowFrame.offset()},setMouseInitialPosition:function(a){tdcWindowFrame._mouseInitialPosition=a},getMouseInitialPosition:function(){return tdcWindowFrame._mouseInitialPosition},_disableBackground:function(a){"undefined"!==typeof a&&!1===a?tdcWindowFrame.$_tdcIframeCover.removeClass("tdc-iframe-cover-transparent"):tdcWindowFrame.$_tdcIframeCover.addClass("tdc-iframe-cover-transparent")},_enableCurrentWindowContent:function(){"undefined"!==
typeof tdcWindowFrame.$_currentWindowFrame&&tdcWindowFrame.$_currentWindowFrame.find(".content").css("pointer-events","")},_disableCurrentWindowContent:function(){"undefined"!==typeof tdcWindowFrame.$_currentWindowFrame&&tdcWindowFrame.$_currentWindowFrame.find(".content").css("pointer-events","none")},setWindowFrame:function(a){b("."+tdcWindowFrame._markerCssClass).addClass("tdw-inactive");a.addClass(tdcWindowFrame._markerCssClass);tdcWindowFrame.$_tdcIframeCover.css({"z-index":++tdcWindowFrame._lastZIndex});
a.css({"z-index":++tdcWindowFrame._lastZIndex});a.removeClass("tdw-inactive")},unsetWindowFrame:function(a){a.removeClass(tdcWindowFrame._markerCssClass);setTimeout(function(){tdcWindowFrame.activeLastWindowFrame()},50)},activeLastWindowFrame:function(){var a=e,c=-1;b("."+tdcWindowFrame._markerCssClass).each(function(d,f){d=b(f);f=parseInt(d.css("z-index"));f>c&&(c=f,a=d)});"undefined"!==typeof a&&a.removeClass("tdw-inactive")},getMarkerCssClass:function(){return tdcWindowFrame._markerCssClass}};
b(window).on("load",function(){tdcWindowFrame.init(["#tdw-css-writer","#tdc-menu-settings","#tdc-page-settings","#tdc-wpeditor","#tdw-css-analyze"])})})(jQuery);var tdcNotice;
(function(b,e){tdcNotice={$_noticeWrapper:e,_isInitialized:!1,_errorNotices:[],inError:!1,notice:function(a,c,b){var d={};_.isUndefined(c)||!0!==c||(d.type="error");_.isUndefined(b)||!0!==b||(d.hasClose=!0);tdcNotice.showNotice(a,d)},showNotice:function(a,c){if(tdcNotice._isInitialized){var d="",f="",e=!1,g=5E3;if("undefined"!==typeof c){if("undefined"!==typeof c.type)switch(c.type){case "error":d="tdc-notice-error";e=!0;break;case "info":d="tdc-notice-info"}"undefined"!==typeof c.hasClose&&!0===
c.hasClose&&(f='<div class="tdc-close-notice"></div>');"undefined"!==typeof c.timeout&&(g=c.timeout)}e&&(a+=" Current state has involved an issue. You could try an UNDO operation (CTRL+Z / CTRL+SHIFT+Z)");var h=b('<div class="tdc-notice '+d+'"><span class="tdc-msg-tag"></span>'+a+f+"</div>");tdcNotice.$_noticeWrapper.append(h);setTimeout(function(){h.addClass("tdc-notice-in")},100);if(e)throw tdcNotice._errorNotices.push(h),tdcNotice.inError=!0,tdcRecycle.init(),b("body").addClass("tdcComposerLoaded"),
a;setTimeout(function(){h.removeClass("tdc-notice-in")},g-1E3);setTimeout(function(){h.css("margin-top","-"+h.outerHeight()+"px")},g-500);setTimeout(function(){h.remove()},g)}},removeAll:function(){tdcNotice._errorNotices.forEach(function(a,c){a.remove()})},init:function(){tdcNotice._isInitialized||(tdcNotice.$_noticeWrapper=b('<div class="tdc-notice-wrapper"></div>'),tdcNotice.$_noticeWrapper.on("click",".tdc-close-notice",function(a){b(this).closest(".tdc-notice").remove()}),b("#tdc-live-iframe-wrapper").append(tdcNotice.$_noticeWrapper),
tdcNotice._isInitialized=!0)}};tdcNotice.init()})(jQuery);var tdcShortcodeParser={};
(function(){tdcShortcodeParser={levels:{},init:function(b){tdcShortcodeParser.levels=_.clone(b);tdcShortcodeParser.levels[3]=tdcShortcodeParser.levels[3].concat(tdcShortcodeParser.levels[5])},multiNext:function(b,e){b=tdcShortcodeParser.levels[b];for(var a,c=0;c<b.length;c++){var d=tdcShortcodeParser.generateTreeElement(wp.shortcode.next(b[c],e));"undefined"!==typeof d&&("undefined"===typeof a||a.index>d.index)&&(a=d)}return a},parse:function(b,e){for(var a=tdcShortcodeParser.multiNext(b,e),c=0,d=
[];"undefined"!==typeof a&&5E3>c;)e=e.substring(a.index+a.content.length),5>b&&(a.child=tdcShortcodeParser.parse(b+1,a.content)),d.push(a),a=tdcShortcodeParser.multiNext(b,e),c++;return d},generateTreeElement:function(b){return b}}})();var tdcInit={};
(function(b,e,a){tdcInit={$formPost:a,_title:"TagDiv Composer Draft",_url:"",$title:a,$titlePromptText:a,$contentWrap:a,$content:a,$contentIfr:a,$originalPostStatus:a,$_wpnonce:a,$postType:a,$postId:a,$postAuthor:a,$excerpt:a,$catslist:a,catslistValue:"",init:function(){tdcInit.$formPost=b("#post");if(tdcInit.$formPost.length){tdcInit.$title=tdcInit.$formPost.find("#title");tdcInit.$titlePromptText=tdcInit.$formPost.find("#title-prompt-text");tdcInit.$contentWrap=tdcInit.$formPost.find("#wp-content-wrap");
tdcInit.$content=tdcInit.$formPost.find("#content");tdcInit.$contentIfr=tdcInit.$formPost.find("#content_ifr");tdcInit.$originalPostStatus=tdcInit.$formPost.find("#original_post_status");tdcInit.$_wpnonce=tdcInit.$formPost.find("#_wpnonce");tdcInit.$postType=tdcInit.$formPost.find("#post_type");tdcInit.$postId=tdcInit.$formPost.find("#post_ID");tdcInit.$postAuthor=tdcInit.$formPost.find("#post_author");tdcInit.$excerpt=tdcInit.$formPost.find("#excerpt");tdcInit.$catslist=tdcInit.$formPost.find("input[type=checkbox][name^=post_category]");
e.each(tdcInit.$catslist,function(a,c,e){a=b(a);a.is(":checked")&&(tdcInit.catslistValue+=a.val()+",")});var a="page";tdcInit.$tdbTemplateType=tdcInit.$formPost.find("#tdb-template-type");tdcInit.$tdbTemplateType.length&&(a=tdcInit.$tdbTemplateType.val());tdcInit._url=window.tdcAdminSettings.adminUrl+"post.php?post_id="+tdcInit.$postId.val()+"&td_action=tdc&tdbTemplateType="+a;"footer"===a||"page"!==tdcInit.$postType.val()&&"tdb_templates"!==tdcInit.$postType.val()||!0!==window.tdcAdminSettings.hasUserRights||
window.tdcAdminSettings.isPageForPosts||b('<div class="tdc-panel-button"><div class="tdc-panel-icon"></div><div class="tdc-panel-link"><a onclick="return tdcInit.savePost( event )" href="'+tdcInit._url+'">TagDiv Composer</a></div></div>').insertAfter("div#titlediv")}},_checkPostContent:function(){tdcInit.$title.length&&tdcInit.$titlePromptText.length&&0===tdcInit.$title.val().trim().length&&(tdcInit.$title.val(tdcInit._title),tdcInit.$titlePromptText.hide());tdcShortcodeParser.init({0:["tdc_zone"],
1:["vc_row"],2:["vc_column"],3:["vc_row_inner"],4:["vc_column_inner"],5:[]});return tdcInit.$contentWrap.hasClass("tmce-active")?tinyMCE.activeEditor.getContent():tdcInit.$formPost.find("#content").val()},savePost:function(a){b(".tdc-panel-button").addClass("tdc-open-editor-loader");setTimeout(function(){b(".tdc-panel-button").removeClass("tdc-open-editor-loader")},2E3);a=tdcInit._checkPostContent();b.ajax({url:window.ajaxurl,type:"POST",data:{"data[wp_autosave][post_id]":tdcInit.$postId.val(),"data[wp_autosave][post_type]":tdcInit.$postType.val(),
"data[wp_autosave][post_author]":tdcInit.$postAuthor.val(),"data[wp_autosave][post_title]":tdcInit.$title.val(),"data[wp_autosave][content]":a,"data[wp_autosave][excerpt]":tdcInit.$excerpt.val(),"data[wp_autosave][catslist]":tdcInit.catslistValue,"data[wp_autosave][auto_draft]":1,"data[wp_autosave][_wpnonce]":tdcInit.$_wpnonce.val(),interval:60,_nonce:window.heartbeatSettings.nonce,action:"heartbeat",screen_id:tdcInit.$postType.val(),has_focus:!1}}).done(function(a,c,b){window.location=tdcInit._url});
return!1}};b(window).ready(function(){tdcInit.init()})})(jQuery,_);var tdcDebug;
(function(b,e){tdcDebug={_debug:!0,_logWindowObj:e,_content:e,_disabled:!1,log:function(a){tdcDebug._debug&&console.log(a)},dumpAllItems:function(){var a=tdcAdminIFrameUI.getIframeWindow();console.group("All items dump:");"undefined"!==typeof a.tdcComposerBlocksApi&&(console.log("%c tdcComposerBlocksApi.items ","background: #222; color: white"),console.log(a.tdcComposerBlocksApi.items));"undefined"!==typeof a.tdPullDown&&(console.log("%c tdPullDown.items ","background: #222; color: white"),console.log(a.tdPullDown.items));
"undefined"!==typeof a.tdAnimationSprite&&(console.log("%c tdAnimationSprite.items ","background: #222; color: white"),console.log(a.tdAnimationSprite.items));"undefined"!==typeof a.tdHomepageFull&&(console.log("%c tdHomepageFull.items ","background: #222; color: white"),console.log(a.tdHomepageFull.items));"undefined"!==typeof a.tdTrendingNow&&(console.log("%c tdTrendingNow.items ","background: #222; color: white"),console.log(a.tdTrendingNow.items));console.groupEnd()},group:function(a,c){!1!==
tdcDebug._debug&&(console.group?console.group(a,c):console.log(a))},groupCollapsed:function(a,c){!1!==tdcDebug._debug&&(console.groupCollapsed?console.groupCollapsed(a,c):console.log(a))},groupEnd:function(){!1!==tdcDebug._debug&&console.groupEnd&&console.groupEnd()},logWindow:function(a){if(e===tdcDebug._logWindowObj){tdcDebug._logWindowObj=b("<div></div>");var c=b('<div style="width: 50px; cursor: pointer; float: left; border: 1px solid black">Clear</div>'),d=b('<div style="width: 50px; cursor: pointer; float: left; border: 1px solid black">Disable</div>');
tdcDebug._content=b('<div style="clear: both"></div>');tdcDebug._logWindowObj.append(c);tdcDebug._logWindowObj.append(d);c.click(function(a){tdcDebug._content.html("")});d.click(function(a){tdcDebug._disabled=!tdcDebug._disabled;tdcDebug._disabled?b(this).css("background-color","#FF000"):b(this).css("background-color","")});tdcDebug._logWindowObj.append(tdcDebug._content);b("body").append(tdcDebug._logWindowObj);tdcDebug._logWindowObj.css({width:300,height:500,border:"1px solid red",position:"fixed",
bottom:0,right:20,"background-color":"#FFFFFF",overflow:"scroll","z-index":1E4})}tdcDebug._disabled||tdcDebug._content.html(a+"<br>"+tdcDebug._content.html())}}})(jQuery);var tdcStore;
(function(b,e,a){tdcStore={_db:a,_dbName:a,_dbStoreName:a,_indexedDB:a,_isInitialized:!1,init:function(a,b){tdcStore._isInitialized||(tdcStore._indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,tdcStore._indexedDB?(tdcStore._dbName=a,tdcStore._dbStoreName=b):console.log("Your browser doesn't support a stable version of IndexedDB. The TagDiv composer can not keep the history!"),tdcStore._isInitialized=!0)},openDb:function(){if(tdcStore._isInitialized){var a=
tdcStore._indexedDB.open(tdcStore._dbName);a.onsuccess=function(a){tdcStore._db=this.result};a.onupgradeneeded=function(a){a.currentTarget.result.createObjectStore(tdcStore._dbStoreName,{keyPath:"id"})}}},getObjectStore:function(a,b){if(tdcStore._isInitialized)return tdcStore._db.transaction(a,b).objectStore(a)},add:function(a,b){if(tdcStore._isInitialized){a={id:a,content:b};b=tdcStore.getObjectStore(tdcStore._dbStoreName,"readwrite");try{var c=b.put(a)}catch(k){throw console.log(k.name),k;}c.onsuccess=
function(a){};c.onerror=function(){}}},get:function(a){var c=b.Deferred(),e=tdcStore.getObjectStore(tdcStore._dbStoreName,"readwrite");try{var k=e.get(a)}catch(g){throw console.log(g.name),g;}k.onsuccess=function(a){c.resolve(this)};k.onerror=function(){};return c}};tdcStore.init("TagDivComposer","History");tdcStore.openDb()})(jQuery,_);
